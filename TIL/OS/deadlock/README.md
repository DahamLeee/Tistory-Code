# Critical Section (임계 영역)

멀티 스레딩 문제점인 동일한 자원을 동시에 접근하는 작업(ex. 공유하는 변수 사용, 동일 파일을 사용하는 등)을 실행하는 코드 영역을 `Critical Section`이라 칭한다.

## Critical Section Problem(임계 영역 문제)
프로세스들이 Critical Section을 함께 사용할 수 있는 프로토콜을 설계하는 것이다.

<b>Requirements (해결을 위한 기본 조건)</b>

- Mutual Exclusion (상호 배제)
    1. 임의의 프로세스 P1이 Critical Section에서 실행중이라면
    2. 다른 프로세스들은 그들이 가진 Critical Section 에서 실행될 수 없다.
- Progress (진행)
    1. Critical Section에서 실행중인 프로세스가 없고
    2. 별도의 동작이 없는 프로세스들만 Critical Section 진입 후보로서 참여될 수 있다.
- Bounded Waiting (한정된 대기)
    1. 프로세스 P1 이 Critical Section에 진입 신청 후 부터 받아들여 질 때까지
    2. 다른 프로세스들이 Critical Section에 진입하는 횟수는 제한이 있어야 한다.

> 교착 상태(DeadLock)란?   
> - 둘 이상의 프로세스가 공유 자원을 무한정 기다리는 상태
> - 교착 상태가 발생할 수 있는 네 가지 조건은 다음과 같습니다.   
        >> 1. 상호 배제   
        >> 2. 점유 대기   
        >> 3. 비선점   
        >> 4. 순환대기    
> - 네 가지 조건 중 하나라도 만족하지 않으면 교착 상태가 되지 않는다.

이 네 가지 조건 중에서 오늘은 상호 배제에 대해서 알아보도록 하겠습니다.

상호 배제는 위에서 정리했다시피 임의의 프로세스가 공유 자원을 점유하고 있다면 다른 프로세스는 이미 점유중인 공유 자원에 접근할 수 없도록 하는 것입니다.

그리고 이를 환경을 강제하는 방법이 Mutex, Semaphore 입니다.

### Mutex

동시에 접근할 수 있는 임계 구역 식당이 있습니다. 이 식당에는 `테이블이 1개(동기화 대상이 오직 하나 뿐)`여서 프로세스 or 스레드라는 손님을 한 명 밖에 받을 수 없습니다. 그래서 2명 이상의 손님을 받을 수 없도록 만드는 것입니다. 고로 동시에 공유 자원에 접근하는 것을 막기 위해 `손님이 들어왔을 때 문을 걸어 잠구고`, `손님이 나갈 때 문을 여는 과정`을 통해 공유 자원에 대한 동시 접근을 방지합니다.

또한, 식당(Critical Section)에 이미 손님이 차있을 경우 그 다음에 들어오는 손님은 대기를 해야 합니다. 대기하는 방법은 다음과 같습니다.

#### sleep waiting
손님을 식당 바로 앞에서 대기시키는 것이 아닌 별도의 대기 장소를 마련하여 줄을 세운 이후에 식당 문이 열렸을 경우 차례 차례 입장시키는 방식입니다. 

#### busy waiting
손님이 식당 바로 앞에서 기다리고 있다가 식당 문이 열렸을 경우 차례 차례 입장시키는 방식입니다.

### Semaphore
Mutex가 접근할 수 있는 손님이 1개(테이블이 1개)였다면 semaphore는 식당의 테이블이 여러 개입니다.

그래서 자원의 개수(남은 테이블의 개수)를 카운팅하면서 자원을 사용하면 감소, 자원을 반납하면 증가하는 방법입니다.

sleep waiting, busy waiting은 Mutex와 동일합니다.
